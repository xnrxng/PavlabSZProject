---
title: "Gene Analysis of Schizophrenia Patient Samples"
author: "Rui Xiang Yu & Nairuz Elazzabi (Pavlidis Lab)"
format: 
    html:
        toc: true
        toc-depth: 3
        auto-stretch: false
    pdf:
        toc: true
        toc-depth: 3 
        fig-pos: "H"
        auto-stretch: false
editor: source
bibliography: references.bib
execute:
    echo: false
    warning: false
---

```{r}
library(tidyverse)
library(knitr)
```

## Summary

TBF

## Introduction

TBF

## Methods

TBF

### Preview of the Data

The data used is from the @388Brains set of cohorts, with its samples. The raw data of the annotated expression matrices can be found [here](https://brainscope.gersteinlab.org/output-sample-annotated-matrix.html). All the samples come from the prefrontal cortex (PFC). The metadata contains the information of the following 12 cohorts:

1. CMC
2. DevBrain
3. Girgenti-multiome
4. IsoHuB
5. LIBD
6. Ma_et_al [@MaSestan]
7. MultiomeBrain
8. PTSDBrainomics
9. SZBDMulti-Seq
10. ROSMAP
11. UCLA-ASD
12. Velmeshev_et_al [@Velmeshev]

However, because no annotated matrices were provided for the ROSMAP cohort, these were filtered out from the metadata.

This is an overview of each cohort:

```{r}
#| label: tbl-total-patients
#| tbl-cap: Each cohort with the total patients studied, the mean of the age of death, and disease studied.

total_patients <- read_csv("../results/1-total_patients.csv")
knitr::kable(total_patients)
```

From @tbl-total-patients, we can see that the CMC cohort has the biggest number of patient samples with 100 samples, followed by SZBDMulti-seq with 72. Ma_et_al has the smallest size, with only 2 samples. CMC and SZBDMulti-seq also have the highest mean of age of death at 71 years and 65 years respectively. Velmeshev_et_al has the lowest one, at 18 years. A variety of diseases are studied in these cohorts, with some cohorts studying none. These diseases include schizophrenia, autism spectrum disorder (ASD), bipolar disorder, major depressive disorder (MDD), post-traumatic stress disorder (PTSD), and Williams Syndrome.

```{r}
#| label: tbl-patientpercondition
#| tbl-cap: Number of patients per condition per cohort. Includes the mean age and the biological sex as well.

patientpercondition <- read_csv("../results/2-patients_per_condition.csv")
knitr::kable(patientpercondition)
```

@tbl-patientpercondition indicates the number of patients per condition in each cohort. The CMC cohort has the highest numbers, with 53 control samples and 47 schizophrenia samples. The UCLA-ASD is second, with 27 ASD samples and 25 control samples. The mean of age at death and the distribution of the biological sexes is also shown in this table.

It must be noted that many patients' age at death was marked as "89+". In order to determine the age distribution and the mean age of death, these values were converted to "89". The number of samples that were marked as "89+" from the Schizophrenia cohorts is in @tbl-elderlypatients.

```{r}
#| label: tbl-elderlypatients
#| tbl-cap: Number of patients annotated as "89+" in Schizophrenia cohorts.

elderlypatients <- read_csv("../results/3-elderlypatients.csv")
knitr::kable(elderlypatients)
```


The age distribution of each condition per cohort was also examined.

![Age distribution in each cohort.](../results/4-agedistribution.png){#fig-agedistribution}

In @fig-agedistribution, the dotted vertical lines are the mean of the age at death for each condition. 

The number of genes and single cells per each Schizophrenia cohort was also looked at in @tbl-genescells. The number of genes is per sample, whereas the number of cells is the total number for all samples in a cohort. 

```{r}
#| label: tbl-genescells
#| tbl-cap: Number of genes and total number of cells per each Schizophrenia cohort.

cells_genes <- read_csv("../results/5-cells_genes.csv")
knitr::kable(cells_genes)
```

The number of genes is quite similar across 3 cohorts. SZBDMulti-Seq has the highest number of total cells, at 603281. MultiomeBrain has the lowest number of total cells, at 134666.

The next thing that was looked into was the number of cells per cell-type per patient. In @fig-celltypedistribution, we can see that L2/3 intratelencephalic excitatory neurons have the highest frequency (279756 in total), especially by the SZBDMulti-Seq cohort. This is followed by oligodendrocytes with 221554 counts in total. Sst Chodl inhibitory neurons have the lowest count at 746 counts. Smooth muscle cells (SMC) have the second lowest count, at 944.

In @fig-depthdistribution, the sequencing depth of each cell was investigated. These results were grouped together per cell type in the following plot, and colored by cohort.

Lastly, the difference in cell type abundance per condition was investigated in each cohort in @fig-abundancecelltype. 

![Cells per cell-type per patient in each cohort.](../results/6-celltypedistribution.png){#fig-celltypedistribution}

![Depth distribution per cell-type per patient in each cohort.](../results/7-depthdistribution.png){#fig-depthdistribution}

![Cell type abundance within conditions across cohorts.](../results/8-abundancecondition.png){#fig-abundancecelltype}

## References
